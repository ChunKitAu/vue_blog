<template>
    <div class="ArticleWrapper">
        <div class='pattern-center-blank'/>
        <!-- 文章头部显示 -->
        <div class="ArticleTop">
            <div class='pattern-attachment-img'>
                <img class='lazyload' :src="blog.picture" alt=""/>
            </div>
            <div class='single-header'>
                <h1 class='entry-title'>{{blog.title}}</h1>
                <p class='entry-census'>
<!--                    <span class="bull">·</span>-->
                    <span>最后修改时间：{{blog.createTime}}</span>
                    <span class="bull">·</span>
                    <span>{{blog.views}}次阅读</span>
                </p>
            </div>
        </div>
        <div class="MainWrapper">
            <div class="flex-items">
                <div class='cell'>
                    <!--文章-->
                    <div id="blog_content" class ='entry-content' v-html="blog.content" v-highlight/>
                    <!-- 赞赏-->
                    <div class='single-reward'>
                        <div class='reward-open'>
                            <p>赏</p>
                            <div class='reward-main'>
                                <ul class='reward-row'>
                                    <li class="wedonate"><img src="http://cdn.fengziy.cn/gblog/wexin_pay.png"><p>微信</p></li>
                                    <li class="alidonate"><img src="http://cdn.fengziy.cn/gblog/ali_pay.jpg"><p>支付宝</p></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="toc" v-show="catalog_show">
                    <side-catalog class="catalog" v-bind="catalogProps">
                        <template #default="{level, isActive}">
                            <i :class="['line-style', isActive ? 'line-style--active' : '']"></i>
                        </template>
                    </side-catalog>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
    import {getArticleById} from "@/api/apis";
    import Banner from '@/components/banner'
    import ArticleButtom from '@/components/ariticle/article_buttom'


    import SideCatalog from "vue-side-catalog";

    export default {
        name: 'articles',
        data() {
            return {
                id: "",
                showDonate: false,
                blog: "",
                comments: [],
                imgUrl: "",
                catalog_show:false,
                catalogProps: {
                    container: "#blog_content",
                    watch: true,
                    height: "calc(100% - 100px)",
                    levelList: ["h1", "h2", "h3", "h4", "h5"],
                    activeColor:'#FE9600',
                }
            }
        },
        components: {
            Banner,
            ArticleButtom,
            SideCatalog
        },
        methods: {
            //获取文章
            getAticle() {
                var _this = this;
                const blogId = this.$route.params.id
                getArticleById(blogId).then(
                    function (response) {
                        //markdown渲染
                        var MarkdownIt = require("markdown-it")
                        var md = new MarkdownIt()
                        _this.blog = response.data.data
                        var content = md.render(response.data.data.content)
                        _this.blog.content = content
                        _this.imgUrl = response.data.data.picture

                        document.title = _this.blog.title
                    },
                    function (error) {
                        console.log(error);
                    }
                )
            },
            //监听目录  固定位置
            handleScroll () {
                var _this = this
                var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
                // 400
                if (scrollTop > 360) {
                    _this.catalog_show = true
                } else {
                    _this.catalog_show = false
                }
            },
            getComment() {
            }
        },
        mounted() {
            var _this = this;
            setTimeout(() => {
                _this.getAticle();
            }, 500)
            window.addEventListener('scroll', this.handleScroll)
        },
        destroyed () {
            window.removeEventListener('scroll', this.handleScroll)
        },
    }
</script>
<style scoped lang="less">
    .ArticleWrapper {
        .pattern-center-blank {
            padding-top: 75px;
            background-color: #fff;
        }

        @media (max-width: 768px) {
            .pattern-center-blank {
                padding-top: 50px;
            }
        }
    }
    .ArticleTop{
        position: relative;
        top: 0;
        left: 0;
        width: 100%;
        overflow: hidden;
        &:before{
            content: "";
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0,0,0,.3);
        }
        .pattern-attachment-img{
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center center;
            background-origin: border-box;
            width: 100%;
            height: 350px;
            img{
                width: 100%;
                height: 100%;
                object-fit: cover;
                pointer-events: none;
            }
        }
        .single-header{
            max-width: 900px;
            padding: 0 10px;
            margin-left: auto;
            margin-right: auto;
            text-align: left;
            top: auto;
            bottom: 20px;
            position: absolute;
            left: 0;
            right: 0;
            color: #fff;
            text-shadow: 2px 2px 10px #000;
            z-index: 1;
            .entry-title{
                font-size: 32px;
                width: 100%;
                color: #fff;
                font-weight: bold;
            }
            .entry-census{
                color: #fff;
                font-size: 14px;
                padding: 18px 0 0;
                line-height: 39px;
                span{
                    color: #fff;
                    font-size: 14px;
                    img{
                        width: 35px;
                        height: 35px;
                        border-radius: 100%;
                        float: left;
                        margin-right: 12px;
                    }
                }
                .bull {
                    margin: 0 5px;
                }
            }
        }
        @media(max-width:768px){
            .pattern-attachment-img{
                height:280px;
            }
            .single-header{
                .entry-title{
                    font-size: 24px;
                }
                .entry-census{
                    padding:0;
                }
            }
        }
    }

    .MainWrapper{
        min-height:600px;
        max-width: 900px;
        padding: 0 10px;
        margin-left: auto;
        margin-right: auto;
        padding-top:50px;
        background-color: rgba(255,255,255,.8);
        display: block;
        @keyframes main {
            0% {
                opacity: 0;
                transform: translateY(50px)
            }
            100% {
                opacity: 1;
                transform: translateY(0)
            }
        }
        .cell{
            margin-right:25px;
        }
        .entry-content {
            position: relative;
            animation: main 1s;
        }

        .entry-content .begin,.single-begin {
            float: left;
            font-size: 3.6em;
            line-height: 1em;
            margin-right: 3px;
            margin-top: 2px;
            font-weight: 700
        }

        @media screen and (max-width: 860px) {
            .entry-content .begin,.single-begin {
                margin-top:6px
            }
        }

        .entry-content ul {
            list-style: disc;
            border: 1px dashed #e4e4e4;
            padding: 15px 10px 15px 50px;
            color: #616161;
            margin-left: 0;
            border-radius: 10px;
            margin:16px 0;
        }

        .entry-content ol {
            list-style: decimal;
            border: 1px dashed #e4e4e4;
            padding: 15px 10px 15px 50px;
            color: #616161;
            margin-left: 0;
            border-radius: 10px;
            margin:16px 0;
        }

        .entry-content table {
            display: block;
            width: 100%;
            overflow: auto;
        }

        .entry-content table th {
            font-weight: 600;
        }

        .entry-content table th,.entry-content table td {
            padding: 6px 13px;
            border: 1px solid #dfe2e5;
        }

        .entry-content table tr {
            background-color: #fff;
            border-top: 1px solid #c6cbd1;
        }

        .entry-content table tr:nth-child(2n) {
            background-color: #f6f8fa;
        }

        .entry-content blockquote {
            padding: 0 1em;
            color: #6a737d;
            border-left: .25em solid #dfe2e5;
        }

        .entry-content blockquote>:first-child {
            margin-top: 0;
        }

        .entry-content blockquote>:last-child {
            margin-bottom: 0;
        }

        .entry-content ol li,.entry-content ul li {
            padding: 8px 0
        }

        .entry-content h3 {
            padding-bottom: 8px;
            border-bottom: 1px dashed #ddd;
            color: #737373;
            margim:17px 0;
        }

        .entry-content h3,.entry-content h4,.entry-content h5 {
            padding-left: 16px;
        }

        .entry-content h1{
            margin:16px 0;
            clear:both;
            font-size:24px;
            color:rgb(64, 64, 64);
        }

        .entry-content h2{
            margin:18px 0;
            clear:both;
            font-size:22px;
            color:rgb(64, 64, 64);
        }

        .entry-content h3{
            margin:17px 0;
            clear:both;
            font-size:20px;
            color:rgb(64, 64, 64);
        }

        .entry-content h4{
            margin:16px 0;
            clear:both;
            font-size:18px;
            color:rgb(64, 64, 64);
        }

        .entry-content h5{
            margin:15px 0;
            clear:both;
            font-size:16px;
            color:rgb(64, 64, 64);
        }

        .entry-content h6{
            margin:14px 0;
            clear:both;
            font-size:14px;
            color:rgb(64, 64, 64);
        }

        .entry-content h2:after,.entry-content h1:after {
            content: "\\00B6";
            position: absolute;
            color: #ff6d6d;
            font-family: 'Merriweather Sans',Helvetica,Tahoma,Arial,'PingFang SC','Hiragino Sans GB','Microsoft Yahei','WenQuanYi Micro Hei',sans-serif;
            padding-left: 6px;
            font-size: 1.03em;
        }

        .entry-content h3:after {
            content: "#";
            left: 0;
            position: absolute;
            color: #ff6d6d;
        }

        .entry-content h4:after {
            content: "â–Œ";
            left: 0;
            position: absolute;
            color: #ff6d6d;
        }

        .entry-content h5:after {
            content: "â™¯";
            left: 0;
            position: absolute;
            color: #ff6d6d;
        }

        .entry-content a {
            color: #e67474;
            position: relative;
        }

        .entry-content a:hover {
            color: orange;
            text-decoration: none;
        }

        .entry-content a:after {
            content: '';
            position: absolute;
            width: 100%;
            transform: scaleX(0);
            height: 2px;
            bottom: 0;
            left: 0;
            background-color: orange;
            transform-origin: bottom right;
            transition: transform .25s ease-out;
        }

        .entry-content a:hover:after {
            transform: scaleX(1);
            transform-origin: bottom left;
        }

        .entry-content p {
            color: #797979;
            margin: 15px 0 22px;
            line-height: 30px;
        }

        .entry-content hr {
            max-width: 100%;
            height: 50px;
            border: none;
            margin-top: 15px;
            margin-bottom: 15px;
        }

        .entry-content .post-password-form {
            text-align: center;
        }


        .entry-content img{
            max-width:100%;
        }

        .example {
            text-align: center;
            border-radius: 4px;
            margin-bottom: 20px;
            padding: 30px 50px;
            margin: 20px 0;
            i{
                background-color: #FE9600;
            }
        }

        .toc{
        }

        .catalog {
            position: fixed;
            top: 80px;
            width: 300px;
            right: 0;
        }
        .side-catalog {
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -ms-flex-direction: column;
            flex-direction: column
        }

        .line-style {
            display: inline-block;
            height: 20px;
            width: 3px;
            background: transparent;
        }
        .line-style--active {
            background: currentColor;
        }

        .side-catalog__title {
            margin-bottom: 5px;
            font-size: 16px;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap
        }

        .side-catalog__list {
            -webkit-box-flex: 1;
            -ms-flex: 1;
            flex: 1;
            overflow: hidden
        }

        .side-catalog__list > div {
            position: relative
        }

        .side-catalog__list-line {
            position: absolute;
            top: 0;
            left: 22px;
            bottom: 0;
            width: 1px;
            background-color: #ebedef;
            opacity: .8;
            z-index: -1
        }

        .side-catalog__list-item {
            cursor: pointer;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            line-height: 1.3;
            padding: 6px 0
        }

        .side-catalog__list-item:hover {
            background-color: rgba(235, 237, 239, .7)
        }

        .side-catalog__list-item--child {
            padding: 4px
        }

        .side-catalog__list-item-icon {
            position: relative;
            display: inline-block;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            width: 6px;
            height: 6px;
            border: 1px solid currentColor;
            border-radius: 50%;
            background: currentColor
        }

        .side-catalog__list-item-icon--child {
            width: 4px;
            height: 4px
        }

        .side-catalog__list-item-title {
            color: currentColor;
            -webkit-box-flex: 1;
            -ms-flex: 1;
            flex: 1;
            padding-left: 15px;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap
        }

        .side-catalog__list-item-title--level1 {
            font-weight: 700
        }

        .flex-items{
            align-items: initial;
        }

        .single-reward{
            position: relative;
            width: 100%;
            margin: 35px auto;
            text-align: center;
            z-index: 90;
            .reward-open {
                position: relative;
                width: 40px;
                height: 40px;
                font-size: 18px;
                padding: 7px;
                color: #fff;
                text-align: center;
                display: inline-block;
                border-radius: 100%;
                background: #d34836;
                cursor: pointer;
            }
            .reward-open:hover .reward-main{
                display: block;
            }
            .reward-main{
                position: absolute;
                top: 40px;
                left: -157px;
                margin: 0;
                padding: 15px 0 0;
                width: 355px;
                background: 0 0;
                display: none;
                animation: main .4s;
            }
            .reward-row{
                list-style: disc;
                border: 1px dashed #e4e4e4;
                margin: 0 auto;
                padding: 20px 15px 10px;
                background: #f5f5f5;
                display: inline-block;
                border-radius: 4px;
                cursor: auto;
                li{
                    list-style-type: none;
                    padding: 0 12px;
                    display: inline-block;
                    img{
                        width: 130px;
                        max-width: 130px;
                        border-radius: 3px;
                        position: relative;
                    }
                    p{
                        color: #666666;
                        font-size: 12px;
                        text-align: center;
                    }
                }
            }
        }

        @media(max-width:768px){
            padding:10px;
            min-height:400px;
            .cell{
                margin:0;
            }
            .catalog{
                display:none;
            }
        }
    }

</style>
